<h1>Instructor's profile and availability</h1>
<!-- Instructor's profile portion -->
<div class="container">
  <div class="col-lg-12 text-center well">
    <h2 class="section-heading">
      <%= image_tag @ta.image.url(:medium) %>
      <h2><%= @ta.name %></h2>
      <h2><%= @ta.email %></h2>
      <% if current_user && current_user.type == "Ta" %>
        <% if current_user == @ta %>
          <%= link_to "Edit Profile", edit_user_path(current_user), class: "btn btn-success" %>
        <% end %>
        <%= link_to "Add a Meeting", new_meeting_path, class: "btn btn-success" %>
        <%= link_to "Your Meetings", ta_meetings_path(@ta), class: "btn btn-primary" %>
      <% else %>
        <%= link_to "Availabe Meetings", ta_meetings_path(@ta), class: "btn btn-primary" %>
      <% end %>
    </h2>
  </div>
</div>

<div class="container pull-right">
	<%= link_to "All instructors", tas_path, class: "btn btn-secondary" %>
	<% if current_user && current_user.type == "Ta" %>
	<%= link_to "View TA's profile", ta_path(@ta), class: "btn btn-secondary" %>
	<% end %>
</div>

<div class="container well">
	<div class="col-lg-12 text-center" id="week-holder">
		<% @groups.each do |week, meetings| %>
			<div class="week">
				<% if @groups.length > 1 %>
					<h2><%= week.to_formatted_s(:long) %> - <%= (week + 6).to_formatted_s(:long) %></h2>
					<button class="prev">Prev</button>
					<button class="next">Next</button>
				<% else %>
					<h2><%= week.to_formatted_s(:long) %> - <%= (week + 6).to_formatted_s(:long) %></h2>
				<% end %>
				<% day = meetings.uniq{|meeting| meeting.start_time.localtime.strftime("%A")} %>
				<ul class="nav nav-tabs">
					<% (0...day.length).each do |i| %>
						<li><a data-toggle="tab" href="#<%= week %><%= day[i].start_time.localtime.strftime("%m-%d") %>"><%= day[i].start_time.localtime.strftime("%A %m-%d") %></a></li>
					<% end %>
				</ul>
				<div class="tab-content">
					<% (0...day.length).each do |j| %>
						<div id="<%= week %><%= day[j].start_time.localtime.strftime("%m-%d") %>" class="tab-pane fade">
							<% meetings.each do |meeting| %>
								<% local_start = meeting.start_time.localtime %>
								<% local_end = meeting.end_time.localtime %>
								<% if local_start.strftime("%A") == day[j].start_time.localtime.strftime("%A") %>
									<% if meeting.subject != nil %>
										<h3><%= meeting.subject %></h3>
									<% end %>
									<h4><strong>Date:</strong> <%= local_start.to_date %></h4>
									<h4><strong>Start:</strong> <%= local_start.strftime("%H:%M") %></h4>
									<h4><strong>End:</strong> <%= local_end.strftime("%H:%M") %></h4>
									<% if current_user && current_user.type == "Student" %>
										<% if meeting.student_id == nil %>
											<%= link_to "Reserve", edit_meeting_path(meeting), class: "btn btn-primary" %>
										<% else %>
											<h4>Reserved by: <%= link_to Student.find(meeting.student_id).name, student_path(meeting.student_id) %></h4>
										<% end %>
									<% elsif current_user && current_user.type == "Ta" %>
										<% if meeting.student_id == nil %>
											<h3><span class="label label-info">Available</span></h3>
											<%= link_to "Edit", edit_meeting_path(meeting), class: "btn btn-secondary btn-sm" %>
										<% else %>
											<h3><span class="label label-warning">Not Available</span></h3>
											<h4>Reserved by: <%= link_to Student.find(meeting.student_id).name, student_path(meeting.student_id) %></h4>
										<% end %>
									<% elsif !current_user %>
										<%= link_to "Reserve", login_path, class: "btn btn-success" %>
									<% end %>
									<hr class="primary">
								<% end %>
							<% end %>
						</div>
					<% end %>
				</div>
			</div>
		<% end %>
	</div>
</div>
